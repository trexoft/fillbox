<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet.pm@latest/dist/leaflet.pm.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet.pm@latest/dist/leaflet.pm.css">
    <link rel="stylesheet" href="src/css/style.css">

    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>
    <script src="https://npmcdn.com/@turf/turf/turf.min.js"></script>
    <script src="https://unpkg.com/leaflet.pm@latest/dist/leaflet.pm.min.js"></script>
    <script src="https://unpkg.com/leaflet.pm@latest/dist/leaflet.pm.min.js"></script>
    <script src="src/js/harita.js"></script>
    <script src="src/js/download.js"></script>


</head>
<body>
<div  id="map"></div>
<div class="buton1">
    <input type="button" value="Fill Box Polygon Area" onclick="fillBoxButton();">
    <input type="button" value="Download GeoJSON" onclick="geojsonindir();">
    <input type="button" value="Download MsSQL" onclick="sqlindir();">
    <input type="button" value="Download Oracle SQL" onclick="oracleSQLDownload();">
    <input type="button" value="Download Postgre SQL" onclick="postgreSQLDownload();">
</div>
</body>
</html>
<!--<script src="mezar.js"></script>-->
<script>
    var centerLng = 38.41893;
    var centerLat = 27.12853;
    var map = L.map('map').setView([centerLng,centerLat], 15);
    var buffer = 0.04;
    var collection = [];
    var geojsonlist = [];
    var yenikutu = false;

    L.tileLayer('http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png', {
        attribution: '<a style="color:#000" target="_blank" href="http://www.alikilic.org">Ali KILIÃ‡</a> | <a style="color:#000" href="mailto:alikilicharita@gmail.com">alikilicharita@gmail.com</a>'
    }).addTo(map);

    var features = {
        Poly:[],
        Rectangle:[],
        Line:[],
        Marker:[],
        Circle:[]
    };
    var options = {
        position: 'topright',
        drawMarker: false,
        drawPolyline: false,
        drawRectangle: false,
        drawPolygon: true,
        drawCircle: false,
        cutPolygon: false,
        editMode: true,
        removalMode: true
    };
    map.pm.addControls(options);

    map.on('pm:create', function(e) {
        var tip = e.shape;
        var f = e.layer;
        features[tip].push(f);
    });

    function fillBoxButton(){
        if(features.Poly.length>0){

            var geojson = features.Poly[0].toGeoJSON();

            var options = {
                longEdge:50,
                shortEdge:30,
                longEdgeOffset:20,
                shortEdgeOffset:20,
                rotateAngel:45,
                intersection:false,
                library:"leaflet",
                map:map,
                addMap:true,
                databaseInfo:{
                    tableName:"box",
                    geometryField:"geoloc",
                    srid:"4326"
                }
            };
            yenikutu = new fillBox(geojson,options);
        }else{
            alert("Please Draw a Polygon");
        }

    }

    function geojsonindir() {
        if(yenikutu!==false){
            if(yenikutu.resultBox.features.length>0){
                yenikutu.getResultGeojsonFile();
            }else{
                fillBoxButton();
                yenikutu.getResultGeojsonFile();
            }
        }else{
            if(features.Poly.length>0){
                fillBoxButton();
                yenikutu.getResultGeojsonFile();
            }else{
                alert("Please Draw a Polygon and press The Button");
            }
        }
    }
    function  sqlindir() {
        if(yenikutu!==false){
            if(yenikutu.resultBox.features.length>0){
                yenikutu.getMsSQLFile();
            }else{
                fillBoxButton();
                yenikutu.getMsSQLFile();
            }
        }else{
            if(features.Poly.length>0){
                fillBoxButton();
                yenikutu.getMsSQLFile();
            }else{
                alert("Please Draw a Polygon and press The Button");
            }
        }
    }

    function oracleSQLDownload(){
        if(yenikutu!==false){
            if(yenikutu.resultBox.features.length>0){
                yenikutu.getOracleSQLFile();
            }else{
                fillBoxButton();
                yenikutu.getOracleSQLFile();
            }
        }else{
            if(features.Poly.length>0){
                fillBoxButton();
                yenikutu.getOracleSQLFile();
            }else{
                alert("Please Draw a Polygon and press The Button");
            }
        }
    }

    function postgreSQLDownload(){
        if(yenikutu!==false){
            if(yenikutu.resultBox.features.length>0){
                yenikutu.getPostgreSQLFile();
            }else{
                fillBoxButton();
                yenikutu.getPostgreSQLFile();
            }
        }else{
            if(features.Poly.length>0){
                fillBoxButton();
                yenikutu.getPostgreSQLFile();
            }else{
                alert("Please Draw a Polygon and press The Button");
            }
        }
    }
</script>
<script src="src/js/fillBox.js"></script>